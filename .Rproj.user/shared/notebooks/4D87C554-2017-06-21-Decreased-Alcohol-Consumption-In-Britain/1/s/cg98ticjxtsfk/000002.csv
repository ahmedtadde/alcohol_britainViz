"0","##===== Functions for Data Wrangling"
"0","ReformatYear <- function(values){"
"0","  #takes in vector of Year values (char type)"
"0","  #removes all occurences of "","""
"0","  #returns modified vector of Year values (char type)"
"0","  foreach(i=1:length(values), .combine = c) %do%{"
"0","    values[i] <- as.character(gsub("","","""", values[i]))"
"0","  }"
"0","}"
"0","ReformatGender <- function(values){"
"0","  #takes in vector of Gender values (char type)"
"0","  #changes all occurences of ""All persons"" => 'All'"
"0","  #returns modified vector of Gender values (char type)"
"0","  "
"0","  values <- stri_trim_both(as.character(values))"
"0","  old <- 'All persons'"
"0","  new <- 'All'"
"0","  values[which(values %in% old)] <- new"
"0","  values"
"0","}"
"0","ReformatAgeRange <- function(values){"
"0","  #takes in vector of AgeRange  values (char type)"
"0","  #changes all occurences of ""All 16+"" => '16+'"
"0","  #returns modified vector of AgeRange values (char type)"
"0","  "
"0","  values <- stri_trim_both(as.character(values))"
"0","  old <- 'All 16+'"
"0","  new <- '16+'"
"0","  values[which(values %in% old)] <- new"
"0","  values"
"0","}"
"0","ReformatProportion <- function(values){"
"0","  #takes in vector of Proportion values (numeric type)"
"0","  #removes all occurences of ""%"""
"0","  #returns modified vector of Proportion values (numeric type)"
"0","  foreach(i=1:length(values), .combine = c) %do%{"
"0","    values[i] <- as.numeric(gsub(""%"","""", values[i]))"
"0","  }"
"0","}"
"0","ReformatQuestion <- function(values){"
"0","  #takes in vector of Question values (char type)"
"0","  #Changes: "
"0","  #'Drank alcohol in the last week' => 'Drank alcohol'"
"0","  #'Drank alcohol on five on more days in the last week' => ''Drank alcohol on 5+ days'"
"0","  #returns modified vector of Question values (char type)"
"0"," "
"0","  old <- 'Drank alcohol on five on more days in the last week'"
"0","  new <- 'Drank alcohol on 5+ days'"
"0","  values[which(values %in% old)] <- new"
"0","  "
"0","  old <- 'Drank alcohol in the last week'"
"0","  new <- 'Drank alcohol'"
"0","  values[which(values %in% old)] <- new"
"0","  "
"0","  values"
"0","}"
"0","MakeBarPlot <- function(df){"
"0","  #takes in a dataframe, all columns included"
"0","  #returns bar plots: Question vs Porportion BY 2005,2016"
"0","  "
"0"," df["
"0","    Year %in% c(2005,2016) & AgeRange == '16+' & Gender == 'All',"
"0","    .(Year, Question, Proportion)"
"0","  ][, "
"0","    Change := c(NA,diff(Proportion)), by= 'Question'"
"0","  ] -> table"
"0","  "
"0","  use.font <- list("
"0","    family = ""Courier New, monospace"","
"0","    size = 15,"
"0","    color = ""black"""
"0","  )"
"0","  "
"0","  ax <- list("
"0","    title = """","
"0","    showticklabels = TRUE,"
"0","    zeroline = FALSE,"
"0","    showline = FALSE,"
"0","    showgrid = FALSE,"
"0","    tickfont = use.font"
"0","  )"
"0","  "
"0","  ay <- list("
"0","    title = '',"
"0","    titlefont = use.font,"
"0","    showticklabels = FALSE,"
"0","    zeroline = FALSE,"
"0","    showline = FALSE,"
"0","    showgrid = FALSE"
"0","  )"
"0","  "
"0","  plot_ly("
"0","    type = 'bar',"
"0","    table,"
"0","    x = ~Question,"
"0","    y = ~Proportion,"
"0","    color = ~Year, colors = c(""#66757F"",""#32AB9F""),"
"0","    hoverinfo = 'text',"
"0","    text = ~paste0("
"0","      ""<br>"",'Proportion: ', Proportion,'%'"
"0","    )"
"0","  )%>%layout("
"0","    title=""Alcohol Consumption Drops in Britain"", titlefont = use.font, xaxis=ax, yaxis=ay ,"
"0","    annotations = list("
"0","      x = ~Question,"
"0","      y = ~Proportion+10,"
"0","      text = c('', '-7.3%', '', '-7.2%', '', '+2%'),"
"0","      xanchor = 'center',"
"0","      yanchor = 'bottom',"
"0","      showarrow = FALSE"
"0","    ),"
"0","    legend = list(x = 0.6, y = 0.7, orientation = 'h')"
"0","  )"
"0","  "
"0","  "
"0","  "
"0","}"
"0","MakeLinePlot <- function(df, age.range, question, counter){"
"0","  #takes in a dataframe,"
"0","  #returns a series plot: ProportionChange vs Year"
"0","  "
"0","  table <- df[AgeRange %in% age.range & Question %in% question]"
"0","  use.font <- list("
"0","    family = ""Courier New, monospace"","
"0","    size = 15,"
"0","    color = ""black"""
"0","  )"
"0","  "
"0","  ax <- list("
"0","    title = """","
"0","    showticklabels = TRUE,"
"0","    zeroline = FALSE,"
"0","    showline = FALSE,"
"0","    showgrid = FALSE,"
"0","    tickfont = use.font"
"0","  )"
"0","  "
"0","  ay <- list("
"0","    title = question,"
"0","    titlefont = use.font,"
"0","    showticklabels = FALSE,"
"0","    zeroline = FALSE,"
"0","    showline = FALSE,"
"0","    showgrid = FALSE"
"0","  )"
"0","  "
"0","  if (counter != 3){"
"0","    "
"0","    table %>% plot_ly("
"0","      x = ~Year,"
"0","      y = ~ProportionChange,"
"0","      type = ""scatter"","
"0","      mode = ""lines"","
"0","      color = ~Gender,"
"0","      colors = c(""#008080"",""#708090"",""#B8860B""),"
"0","      hoverinfo =""text"","
"0","      showlegend = FALSE,"
"0","      text =~paste0("
"0","        '<br>', question,"
"0","        '<br>', 'Gender: ', Gender,"
"0","        '<br>', 'Change: ', ProportionChange,""%"","
"0","        '<br>', 'Year: ', Year"
"0","        "
"0","      )"
"0","    )%>%"
"0","      layout("
"0","        title = age.range, "
"0","        titlefont = use.font , "
"0","        xaxis = ax, "
"0","        yaxis = ay,"
"0","        autosize = T"
"0","      )"
"0","  }else{"
"0","    table %>% plot_ly("
"0","      x = ~Year,"
"0","      y = ~ProportionChange,"
"0","      type = ""scatter"","
"0","      mode = ""lines"","
"0","      color = ~Gender,"
"0","      colors = c(""#008080"",""#708090"",""#B8860B""),"
"0","      hoverinfo =""text"","
"0","      # showlegend = TRUE"
"0","      text =~paste0("
"0","        '<br>', question,"
"0","        '<br>', 'Gender: ', Gender,"
"0","        '<br>', 'Change: ', ProportionChange,""%"","
"0","        '<br>', 'Year: ', Year"
"0","        "
"0","      )"
"0","    )%>%"
"0","      layout("
"0","        title = age.range, "
"0","        titlefont = use.font , "
"0","        xaxis = ax, "
"0","        yaxis = ay,"
"0","        autosize = T,"
"0","        legend = list(orientation = 'h')"
"0","      )"
"0","  }"
"0","  "
"0","  "
"0","  "
"0","}"
"0","FetchLinePlots <- function(df){"
"0","  #takes in a dataframe"
"0","  #returns a nested list of plots... by Age Range, then by Question"
"0","  "
"0","  age.ranges <- unique(df$AgeRange)"
"0","  questions <- unique(df$Question)"
"0","  "
"0","  foreach(i=1:length(age.ranges)) %do%{"
"0","    return("
"0","      foreach(j=1:length(questions)) %do%{"
"0","        return(MakeLinePlot(df, age.ranges[i], questions[j], j))"
"0","      }"
"0","    )"
"0","  } -> all.plots"
"0","  "
"0","  names(all.plots) <- age.ranges"
"0","  "
"0","  "
"0","  return(all.plots)"
"0","}"
