{
    "collab_server" : "",
    "contents" : "# Decreased Alcohol Consimption in Britain Since 2005\n\n\n```r\n##=====  Loading Libraries for Processing\n# load pacman first; then from pacman, use p_load to load other libraries\n# This is so that p_load can automatically install the package if it's not\n# already installed => efficient fulfillment of package requirements!\n\nlibrary(pacman)\np_load(data.table)\np_load(foreach)\np_load(plotly)\np_load(dplyr)\np_load(stringi)\n\n```\n\n\n\n```r\n##===== Functions for Data Wrangling\n\nReformatYear <- function(values){\n  #takes in vector of Year values (char type)\n  #removes all occurences of \",\"\n  #returns modified vector of Year values (char type)\n\n  foreach(i=1:length(values), .combine = c) %do%{\n    values[i] <- as.character(gsub(\",\",\"\", values[i]))\n  }\n}\n\n\nReformatGender <- function(values){\n  #takes in vector of Gender values (char type)\n  #changes all occurences of \"All persons\" => 'All'\n  #returns modified vector of Gender values (char type)\n  \n  values <- stri_trim_both(as.character(values))\n  old <- 'All persons'\n  new <- 'All'\n  values[which(values %in% old)] <- new\n  values\n}\n\n\nReformatAgeRange <- function(values){\n  #takes in vector of AgeRange  values (char type)\n  #changes all occurences of \"All 16+\" => '16+'\n  #returns modified vector of AgeRange values (char type)\n  \n  values <- stri_trim_both(as.character(values))\n  old <- 'All 16+'\n  new <- '16+'\n  values[which(values %in% old)] <- new\n  values\n}\n\n\nReformatProportion <- function(values){\n  #takes in vector of Proportion values (numeric type)\n  #removes all occurences of \"%\"\n  #returns modified vector of Proportion values (numeric type)\n\n  foreach(i=1:length(values), .combine = c) %do%{\n    values[i] <- as.numeric(gsub(\"%\",\"\", values[i]))\n  }\n}\n\n\nReformatQuestion <- function(values){\n  #takes in vector of Question values (char type)\n  #Changes: \n  #'Drank alcohol in the last week' => 'Drank alcohol'\n  #'Drank alcohol on five on more days in the last week' => ''Drank alcohol on 5+ days'\n  #returns modified vector of Question values (char type)\n \n  old <- 'Drank alcohol on five on more days in the last week'\n  new <- 'Drank alcohol on 5+ days'\n  values[which(values %in% old)] <- new\n  \n  old <- 'Drank alcohol in the last week'\n  new <- 'Drank alcohol'\n  values[which(values %in% old)] <- new\n  \n  values\n}\n\n\n\nMakeBarPlot <- function(df){\n  #takes in a dataframe, all columns included\n  #returns bar plots: Question vs Porportion BY 2005,2016\n  \n df[\n    Year %in% c(2005,2016) & AgeRange == '16+' & Gender == 'All',\n    .(Year, Question, Proportion)\n  ][, \n    Change := c(NA,diff(Proportion)), by= 'Question'\n  ] -> table\n  \n  use.font <- list(\n    family = \"Courier New, monospace\",\n    size = 15,\n    color = \"black\"\n  )\n  \n  ax <- list(\n    title = \"\",\n    showticklabels = TRUE,\n    zeroline = FALSE,\n    showline = FALSE,\n    showgrid = FALSE,\n    tickfont = use.font\n  )\n  \n  ay <- list(\n    title = '',\n    titlefont = use.font,\n    showticklabels = FALSE,\n    zeroline = FALSE,\n    showline = FALSE,\n    showgrid = FALSE\n  )\n  \n  plot_ly(\n    type = 'bar',\n    table,\n    x = ~Question,\n    y = ~Proportion,\n    color = ~Year, colors = c(\"#66757F\",\"#32AB9F\"),\n    hoverinfo = 'text',\n    text = ~paste0(\n      \"<br>\",'Proportion: ', Proportion,'%'\n    )\n  )%>%layout(\n    title=\"Alcohol Consumption Drops in Britain\", titlefont = use.font, xaxis=ax, yaxis=ay ,\n    annotations = list(\n      x = ~Question,\n      y = ~Proportion+10,\n      text = c('', '-7.3%', '', '-7.2%', '', '+2%'),\n      xanchor = 'center',\n      yanchor = 'bottom',\n      showarrow = FALSE\n    ),\n    legend = list(x = 0.6, y = 0.7, orientation = 'h')\n  )\n  \n  \n  \n}\n\nMakeLinePlot <- function(df, age.range, question, counter){\n  #takes in a dataframe,\n  #returns a series plot: ProportionChange vs Year\n  \n  table <- df[AgeRange %in% age.range & Question %in% question]\n  use.font <- list(\n    family = \"Courier New, monospace\",\n    size = 15,\n    color = \"black\"\n  )\n  \n  ax <- list(\n    title = \"\",\n    showticklabels = TRUE,\n    zeroline = FALSE,\n    showline = FALSE,\n    showgrid = FALSE,\n    tickfont = use.font\n  )\n  \n  ay <- list(\n    title = question,\n    titlefont = use.font,\n    showticklabels = FALSE,\n    zeroline = FALSE,\n    showline = FALSE,\n    showgrid = FALSE\n  )\n  \n  if (counter != 3){\n    \n    table %>% plot_ly(\n      x = ~Year,\n      y = ~ProportionChange,\n      type = \"scatter\",\n      mode = \"lines\",\n      color = ~Gender,\n      colors = c(\"#008080\",\"#708090\",\"#B8860B\"),\n      hoverinfo =\"text\",\n      showlegend = FALSE,\n      text =~paste0(\n        '<br>', question,\n        '<br>', 'Gender: ', Gender,\n        '<br>', 'Change: ', ProportionChange,\"%\",\n        '<br>', 'Year: ', Year\n        \n      )\n    )%>%\n      layout(\n        title = age.range, \n        titlefont = use.font , \n        xaxis = ax, \n        yaxis = ay,\n        autosize = T\n      )\n  }else{\n    table %>% plot_ly(\n      x = ~Year,\n      y = ~ProportionChange,\n      type = \"scatter\",\n      mode = \"lines\",\n      color = ~Gender,\n      colors = c(\"#008080\",\"#708090\",\"#B8860B\"),\n      hoverinfo =\"text\",\n      # showlegend = TRUE\n      text =~paste0(\n        '<br>', question,\n        '<br>', 'Gender: ', Gender,\n        '<br>', 'Change: ', ProportionChange,\"%\",\n        '<br>', 'Year: ', Year\n        \n      )\n    )%>%\n      layout(\n        title = age.range, \n        titlefont = use.font , \n        xaxis = ax, \n        yaxis = ay,\n        autosize = T,\n        legend = list(orientation = 'h')\n      )\n  }\n  \n  \n  \n}\n\nFetchLinePlots <- function(df){\n  #takes in a dataframe\n  #returns a nested list of plots... by Age Range, then by Question\n  \n  age.ranges <- unique(df$AgeRange)\n  questions <- unique(df$Question)\n  \n  foreach(i=1:length(age.ranges)) %do%{\n    return(\n      foreach(j=1:length(questions)) %do%{\n        return(MakeLinePlot(df, age.ranges[i], questions[j], j))\n      }\n    )\n  } -> all.plots\n  \n  names(all.plots) <- age.ranges\n  \n  \n  return(all.plots)\n}\n```",
    "created" : 1498077263284.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2540584963",
    "id" : "8BCBF4AF",
    "lastKnownWriteTime" : 1498078451,
    "last_content_update" : 1498078451098,
    "path" : "~/GITHUB/alcohol_britainViz/2017-06-21-Decreased-Alcohol-Consumption-In-Britain-Since-2005.md",
    "project_path" : "2017-06-21-Decreased-Alcohol-Consumption-In-Britain-Since-2005.md",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "markdown"
}